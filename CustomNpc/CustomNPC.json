[
  {
    "id": "update_stat",
    "type": "effect_on_condition",
    "eoc_type": "ACTIVATION"
  },
  {
    "id": "CustomNPC_if0",
    "type": "effect_on_condition",
    "effect": [
      {"math":["u_currhp","=","u_hp()"]}
    ],
    "condition": {"math":["u_currhp","==","0"]}
  },
  {
    "id": "CNPC_EOC_InitCurrHP",
    "type": "effect_on_condition",
    "effect": [
      {"run_eocs":"CustomNPC_if0"}
    ],
    "eoc_type": "ACTIVATION"
  },
  {
    "id": "CNPC_EOC_UpdateInitCurrHP",
    "type": "effect_on_condition",
    "effect": [
      {"u_cast_spell":{"id":"CNPC_SPELL_InitCurrHP"}}
    ],
    "eoc_type": "ACTIVATION"
  },
  {
    "id": "CustomNPC_if1",
    "type": "effect_on_condition",
    "effect": [
      {"u_cast_spell":{"id":"CNPC_SPELL_SummonTarget"}},
      {"math":["has_target","=","1"]}
    ],
    "condition": {"and":[{"math":["u_currhp",">","u_hp()"]},{"math":["has_target","==","0"]}]}
  },
  {
    "id": "CNPC_EOC_CheckCurrHP",
    "type": "effect_on_condition",
    "effect": [
      {"math":["mag1","=","u_currhp"]},
      {"math":["mag2","=","u_hp()"]},
      {"run_eocs":"CustomNPC_if1"},
      {"math":["u_currhp","=","u_hp()"]}
    ],
    "eoc_type": "ACTIVATION"
  },
  {
    "id": "CustomNPC_if2",
    "type": "effect_on_condition",
    "effect": [
      {"math":["u_notIdle","=","10"]},
      {"u_cast_spell":{"id":"CNPC_SPELL_CheckCurrHP"}},
      {"math":["has_target","=","0"]},
      {"u_cast_spell":{"id":"CNPC_SPELL_TestConeSpell"},"targeted":true},
      {"run_eocs":"CNPC_EOC_CharCauseHit"}
    ],
    "condition": {"u_has_trait":"CNPC_MUT_CnpcFlag"}
  },
  {
    "id": "CNPC_EOC_HitEocs",
    "type": "effect_on_condition",
    "effect": [
      {"run_eocs":"CustomNPC_if2"}
    ],
    "eoc_type": "ACTIVATION"
  },
  {
    "id": "CNPC_EOC_SpawnBaseNpc",
    "type": "effect_on_condition",
    "effect": [
      {"u_spawn_npc":"CNPC_NPC_BaseNpc","real_count":1,"min_radius":1,"max_radius":1,"spawn_message":"生成了一个基础NPC"}
    ]
  },
  {
    "id": "CustomNPC_if3",
    "type": "effect_on_condition",
    "effect": [
      {"math":["u_notIdle","=","4"]},
      {"run_eocs":"CNPC_EOC_CharMove"}
    ],
    "condition": {"u_has_trait":"CNPC_MUT_CnpcFlag"}
  },
  {
    "id": "CNPC_EOC_MoveEvent",
    "type": "effect_on_condition",
    "effect": [
      {"run_eocs":"CustomNPC_if3"}
    ],
    "eoc_type": "EVENT",
    "required_event": "avatar_moves"
  },
  {
    "id": "CNPC_EOC_PlayerUpdate",
    "type": "effect_on_condition",
    "effect": [
      {"run_eocs":"CNPC_EOC_UpdateInitCurrHP"},
      {"run_eocs":"update_stat"}
    ],
    "recurrence": 1
  },
  {
    "id": "CustomNPC_if5",
    "type": "effect_on_condition",
    "effect": [
      {"math":["u_notIdle","=","4"]}
    ],
    "false_effect": [
      {"math":["u_notIdle","=","u_notIdle-1"]}
    ],
    "condition": {
      "compare_string":[
        {"u_val":"var","var_name":"u_char_currloc"},
        {"u_val":"var","var_name":"u_char_preloc"}
      ]
    }
  },
  {
    "id": "CustomNPC_if6",
    "type": "effect_on_condition",
    "effect": [
      {"run_eocs":"CNPC_EOC_CharMove"}
    ],
    "condition": {"math":["u_notIdle",">","0"]}
  },
  {
    "id": "CustomNPC_if7",
    "type": "effect_on_condition",
    "effect": [
      {"math":["u_notIdle","=","0"]},
      {"run_eocs":"CNPC_EOC_CharIdle"}
    ],
    "condition": {"math":["u_notIdle","<=","0"]}
  },
  {
    "id": "CustomNPC_if4",
    "type": "effect_on_condition",
    "effect": [
      {"run_eocs":"CNPC_EOC_CharUpdate"},
      {"set_string_var":{"mutator":"loc_relative_u","target":"(0,1,0)"},"target_var":{"u_val":"var","var_name":"u_char_currloc"}},
      {"run_eocs":"CustomNPC_if5"},
      {"set_string_var":{"mutator":"loc_relative_u","target":"(0,1,0)"},"target_var":{"u_val":"var","var_name":"u_char_preloc"}},
      {"run_eocs":"CustomNPC_if6"},
      {"run_eocs":"CustomNPC_if7"}
    ],
    "condition": {"u_has_trait":"CNPC_MUT_CnpcFlag"}
  },
  {
    "id": "CNPC_EOC_GlobalUpdate",
    "type": "effect_on_condition",
    "effect": [
      {"run_eocs":"CustomNPC_if4"}
    ],
    "recurrence": 1,
    "global": true,
    "run_for_npcs": true
  },
  {
    "id": "CustomNPC",
    "type": "effect_on_condition"
  }
]